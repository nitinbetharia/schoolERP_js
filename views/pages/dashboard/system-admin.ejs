<!-- System Admin Dashboard -->

<div class="row">
   <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
         <div>
            <h1 class="h3 mb-1">System Dashboard</h1>
            <p class="text-muted mb-0">Overview of all trusts and system health</p>
         </div>
         <div>
            <button type="button" class="btn btn-brand-primary" data-bs-toggle="modal" data-bs-target="#addTrustModal">
               <i class="fas fa-plus me-1"></i>Add Trust
            </button>
         </div>
      </div>
   </div>
</div>

<!-- Stats Cards -->
<div class="row g-3 mb-4">
   <div class="col-md-3">
      <div class="card bg-primary text-white">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">Total Trusts</h6>
                  <h2 class="mb-0"><%= stats ? stats.totalTrusts : '-' %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-building fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="col-md-3">
      <div class="card bg-success text-white">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">Active Trusts</h6>
                  <h2 class="mb-0"><%= stats ? stats.activeTrusts : '-' %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-school fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="col-md-3">
      <div class="card bg-info text-white">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">System Users</h6>
                  <h2 class="mb-0"><%= stats ? stats.totalSystemUsers : '-' %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-user-cog fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="col-md-3">
      <div class="card <%= stats && stats.systemHealth === 'healthy' ? 'bg-warning' : 'bg-danger' %> text-white">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">System Health</h6>
                  <h2 class="mb-0">
                     <% if (stats && stats.systemHealth === 'healthy') { %>
                        <i class="fas fa-check"></i>
                     <% } else if (stats && stats.systemHealth === 'unhealthy') { %>
                        <i class="fas fa-exclamation-triangle"></i>
                     <% } else { %>
                        <i class="fas fa-question"></i>
                     <% } %>
                  </h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-heartbeat fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <!-- New row of stats -->
   <div class="col-md-3">
      <div class="card bg-warning text-dark">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">Pending Trusts</h6>
                  <h2 class="mb-0"><%= stats ? stats.pendingTrusts : '-' %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-hourglass-half fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="col-md-3">
      <div class="card bg-secondary text-white">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">Suspended</h6>
                  <h2 class="mb-0"><%= stats && stats.suspendedTrusts || 0 %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-pause-circle fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="col-md-3">
      <div class="card bg-dark text-white">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">Inactive</h6>
                  <h2 class="mb-0"><%= stats && stats.inactiveTrusts || 0 %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-power-off fa-2x opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
   <div class="col-md-3">
      <div class="card bg-success-subtle">
         <div class="card-body">
            <div class="d-flex justify-content-between">
               <div>
                  <h6 class="card-title mb-1">New (7 days)</h6>
                  <h2 class="mb-0"><%= stats && stats.newTrusts7d || 0 %></h2>
               </div>
               <div class="align-self-center">
                  <i class="fas fa-calendar-plus fa-2x text-success opacity-75"></i>
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

<!-- Main Content -->
<div class="row">
   <!-- Recent Activity -->
   <div class="col-lg-8">
      <div class="card">
         <div class="card-header">
            <h5 class="card-title mb-0">Recent Activity</h5>
         </div>
         <div class="card-body">
            <div class="table-responsive">
               <table class="table table-sm">
                  <thead>
                     <tr>
                        <th>Time</th>
                        <th>Entity</th>
                        <th>Action</th>
                        <th>Status</th>
                     </tr>
                  </thead>
                  <tbody>
                     <% if (recent && recent.length) { %>
                        <% recent.forEach(item => { %>
                           <tr>
                              <td><small class="text-muted"><%= new Date(item.time).toLocaleString() %></small></td>
                              <td>
                                 <% if (item.type === 'TRUST') { %>
                                    <i class="fas fa-building me-1 text-primary"></i>
                                    <%= item.title %> <small class="text-muted">(<%= item.code %>)</small>
                                 <% } else { %>
                                    <i class="fas fa-user-cog me-1 text-info"></i>
                                    <%= item.title %> <small class="text-muted">(<%= item.code %>)</small>
                                 <% } %>
                              </td>
                              <td><%= item.action %></td>
                              <td>
                                 <span class="badge <%= item.status === 'ACTIVE' ? 'bg-success' : item.status === 'SETUP_PENDING' ? 'bg-warning' : 'bg-secondary' %>"><%= item.status %></span>
                              </td>
                           </tr>
                        <% }) %>
                     <% } else { %>
                        <tr>
                           <td colspan="4" class="text-center text-muted py-4">No recent activity</td>
                        </tr>
                     <% } %>
                  </tbody>
               </table>
            </div>
         </div>
      </div>
   </div>

   <!-- System Status -->
   <div class="col-lg-4">
      <div class="card">
         <div class="card-header">
            <h5 class="card-title mb-0">System Status</h5>
         </div>
         <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-3">
               <span>Database</span>
               <span class="badge <%= stats && stats.databaseStatus === 'connected' ? 'bg-success' : 'bg-danger' %>">
                  <%= stats && stats.databaseStatus === 'connected' ? 'Online' : 'Offline' %>
               </span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-3">
               <span>System Health</span>
               <span class="badge <%= stats && stats.systemHealth === 'healthy' ? 'bg-success' : stats && stats.systemHealth === 'unhealthy' ? 'bg-danger' : 'bg-warning' %>">
                  <% if (stats && stats.systemHealth === 'healthy') { %>
                     Healthy
                  <% } else if (stats && stats.systemHealth === 'unhealthy') { %>
                     Issues
                  <% } else { %>
                     Unknown
                  <% } %>
               </span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-3">
               <span>Active Users</span>
               <span class="badge bg-info"><%= stats ? stats.activeUsers : 0 %> online</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-3">
               <span>Pending Trusts</span>
               <span class="badge <%= stats && stats.pendingTrusts > 0 ? 'bg-warning' : 'bg-success' %>">
                  <%= stats ? stats.pendingTrusts : 0 %> pending
               </span>
            </div>
            <hr />
            <div class="text-center">
               <a href="/system/health" class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-chart-line me-1"></i>View Details
               </a>
            </div>
            <% if (stats && stats.error) { %>
            <div class="mt-3">
               <div class="alert alert-warning alert-sm mb-0">
                  <small><i class="fas fa-exclamation-triangle me-1"></i><%= stats.error %></small>
               </div>
            </div>
            <% } %>
         </div>
      </div>
   </div>
</div>

<!-- RBAC Quick Actions -->
<div class="row mt-3">
   <div class="col-12">
   <div class="card">
         <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="card-title mb-0"><i class="fas fa-rocket me-2"></i>Quick Actions</h5>
      <small class="text-muted">Based on RBAC</small>
         </div>
         <div class="card-body">
      <div class="row g-3">
               <% if (rbacMenu && rbacMenu.length) { %>
                  <% rbacMenu.forEach(item => { %>
                     <div class="col-md-3">
            <div class="border rounded p-3 h-100">
               <div class="d-flex justify-content-between align-items-center mb-2">
               <strong><i class="bi bi-grid-3x3-gap me-2"></i><%= item.name %></strong>
               </div>
               <div class="d-flex flex-wrap gap-2">
                              <% if (item.canRead && item.openHref) { %>
                  <a href="<%= item.openHref %>" class="btn btn-sm btn-outline-primary"><i class="bi bi-folder2-open"></i> Open</a>
                              <% } %>
                              <% if (item.canCreate && item.newHref) { %>
                  <a href="<%= item.newHref %>" class="btn btn-sm btn-outline-success"><i class="bi bi-plus-circle"></i> New</a>
                              <% } %>
                              <% if (item.canUpdate && item.manageHref) { %>
                  <a href="<%= item.manageHref %>" class="btn btn-sm btn-outline-warning"><i class="bi bi-sliders"></i> Manage</a>
                              <% } %>
                              <% if (item.canDelete && item.adminHref) { %>
                  <a href="<%= item.adminHref %>" class="btn btn-sm btn-outline-danger"><i class="bi bi-shield-lock"></i> Admin</a>
                              <% } %>
                           </div>
                        </div>
                     </div>
                  <% }) %>
               <% } else { %>
                  <div class="col-12 text-muted">No RBAC actions available</div>
               <% } %>
            </div>
         </div>
      </div>
   </div>
</div>
