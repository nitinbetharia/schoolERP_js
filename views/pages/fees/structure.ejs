<!-- Fee Structure Management -->
<main class="main-content">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-content">
            <nav class="breadcrumb">
                <a href="/fees" class="breadcrumb-link">
                    <i class="fas fa-money-bill-wave"></i>
                    Fee Management
                </a>
                <span class="breadcrumb-separator">/</span>
                <span class="breadcrumb-current">Fee Structure</span>
            </nav>
            
            <h1 class="page-title">Fee Structure Management</h1>
            <p class="page-description">Define and manage fee structures for different classes</p>
        </div>
        
        <div class="header-actions">
            <button class="btn btn-brand-primary" onclick="openAddFeeModal()">
                <i class="fas fa-plus"></i>
                Add Fee Type
            </button>
        </div>
    </div>

    <!-- Fee Structure Overview -->
    <div class="overview-cards d-none d-md-grid">
        <div class="overview-card total-fees d-none d-md-grid">
            <div class="card-icon">
                <i class="fas fa-list-alt"></i>
            </div>
            <div class="card-details">
                <h3><%= feeStructures.length %></h3>
                <p>Fee Types Defined</p>
            </div>
        </div>
        
        <div class="overview-card active-fees d-none d-md-grid">
            <div class="card-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="card-details">
                <h3><%= feeStructures.filter(f => f.status === 'Active').length %></h3>
                <p>Active Fee Types</p>
            </div>
        </div>
        
        <div class="overview-card monthly-fees d-none d-md-grid">
            <div class="card-icon">
                <i class="fas fa-calendar"></i>
            </div>
            <div class="card-details">
                <h3><%= feeStructures.filter(f => f.frequency === 'Monthly').length %></h3>
                <p>Monthly Fees</p>
            </div>
        </div>
        
        <div class="overview-card quarterly-fees d-none d-md-grid">
            <div class="card-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="card-details">
                <h3><%= feeStructures.filter(f => f.frequency === 'Quarterly').length %></h3>
                <p>Quarterly Fees</p>
            </div>
        </div>
    </div>

    <!-- Fee Structure Table -->
    <div class="table-container">
        <div class="table-header">
            <h3>Fee Structure Details</h3>
            <div class="table-actions">
                <button class="btn btn-outline" onclick="exportFeeStructure()">
                    <i class="fas fa-download"></i>
                    Export Structure
                </button>
                <button class="btn btn-secondary" onclick="bulkUpdateFees()">
                    <i class="fas fa-edit"></i>
                    Bulk Update
                </button>
            </div>
        </div>

        <div class="table-responsive">
            <div class="data-table-container">
                <div class="data-table-container">
                <table class="data-table fee-structure-table">
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Fee Type</th>
                        <th>Amount</th>
                        <th>Frequency</th>
                        <th>Due Date</th>
                        <th>Late Fee</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (feeStructures && feeStructures.length > 0) { %>
                        <% feeStructures.forEach(function(fee) { %>
                            <tr data-fee-id="<%= fee.id %>">
                                <td class="class-name">
                                    <strong><%= fee.class %></strong>
                                </td>
                                <td class="fee-type">
                                    <div class="fee-type-info">
                                        <strong><%= fee.feeType %></strong>
                                        <% if (fee.description) { %>
                                            <small class="fee-description"><%= fee.description %></small>
                                        <% } %>
                                    </div>
                                </td>
                                <td class="amount">
                                    <strong>₹<%= fee.amount.toLocaleString('en-IN') %></strong>
                                </td>
                                <td>
                                    <span class="frequency-badge frequency-<%= fee.frequency.toLowerCase() %>">
                                        <%= fee.frequency %>
                                    </span>
                                </td>
                                <td class="due-date">
                                    <% if (fee.frequency === 'Monthly') { %>
                                        <%= fee.dueDate %><sup>th</sup> of every month
                                    <% } else if (fee.frequency === 'Quarterly') { %>
                                        <%= fee.dueDate %><sup>th</sup> of quarter
                                    <% } else { %>
                                        <%= fee.dueDate %>
                                    <% } %>
                                </td>
                                <td class="late-fee">
                                    <% if (fee.lateFee) { %>
                                        ₹<%= fee.lateFee.toLocaleString('en-IN') %>
                                    <% } else { %>
                                        <span class="no-late-fee">No late fee</span>
                                    <% } %>
                                </td>
                                <td>
                                    <span class="status-badge status-<%= fee.status.toLowerCase() %>">
                                        <% if (fee.status === 'Active') { %>
                                            <i class="fas fa-check-circle"></i>
                                        <% } else { %>
                                            <i class="fas fa-pause-circle"></i>
                                        <% } %>
                                        <%= fee.status %>
                                    </span>
                                </td>
                                <td class="actions">
                                    <button class="action-btn edit-btn" 
                                            onclick="editFeeStructure(<%= fee.id %>)"
                                            title="Edit Fee Structure">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    
                                    <button class="action-btn copy-btn" 
                                            onclick="copyFeeStructure(<%= fee.id %>)"
                                            title="Copy to Other Classes">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                    
                                    <button class="action-btn toggle-btn" 
                                            onclick="toggleFeeStatus(<%= fee.id %>)"
                                            title="Toggle Status">
                                        <% if (fee.status === 'Active') { %>
                                            <i class="fas fa-pause"></i>
                                        <% } else { %>
                                            <i class="fas fa-play"></i>
                                        <% } %>
                                    </button>
                                    
                                    <button class="action-btn delete-btn" 
                                            onclick="deleteFeeStructure(<%= fee.id %>)"
                                            title="Delete Fee Structure">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        <% }); %>
                    <% } else { %>
                        <tr>
                            <td colspan="8" class="no-data">
                                <div class="no-data-message">
                                    <i class="fas fa-list-alt fa-3x"></i>
                                    <h4>No Fee Structure Defined</h4>
                                    <p>Start by adding fee types for different classes.</p>
                                    <button class="btn btn-brand-primary" onclick="openAddFeeModal()">
                                        <i class="fas fa-plus"></i>
                                        Add First Fee Type
                                    </button>
                                </div>
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
    </div>
</main>

<!-- Add/Edit Fee Structure Modal -->
<div id="feeStructureModal" class="modal">
    <div class="modal-content large-modal">
        <div class="modal-header">
            <h3 id="modalTitle">Add Fee Structure</h3>
            <button class="modal-close" onclick="closeFeeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <form id="feeStructureForm" onsubmit="saveFeeStructure(event)">
                <input type="hidden" id="feeId" name="feeId">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label for="feeClass" class="required">Class</label>
                        <select id="feeClass" name="class" class="form-control" required>
                            <option value="">Select Class</option>
                            <option value="Nursery">Nursery</option>
                            <option value="LKG">LKG</option>
                            <option value="UKG">UKG</option>
                            <option value="1st">1st</option>
                            <option value="2nd">2nd</option>
                            <option value="3rd">3rd</option>
                            <option value="4th">4th</option>
                            <option value="5th">5th</option>
                            <option value="6th">6th</option>
                            <option value="7th">7th</option>
                            <option value="8th">8th</option>
                            <option value="9th">9th</option>
                            <option value="10th">10th</option>
                            <option value="11th">11th</option>
                            <option value="12th">12th</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="feeType" class="required">Fee Type</label>
                        <select id="feeType" name="feeType" class="form-control" required>
                            <option value="">Select Fee Type</option>
                            <option value="Tuition Fee">Tuition Fee</option>
                            <option value="Development Fee">Development Fee</option>
                            <option value="Computer Fee">Computer Fee</option>
                            <option value="Library Fee">Library Fee</option>
                            <option value="Sports Fee">Sports Fee</option>
                            <option value="Laboratory Fee">Laboratory Fee</option>
                            <option value="Transport Fee">Transport Fee</option>
                            <option value="Examination Fee">Examination Fee</option>
                            <option value="Admission Fee">Admission Fee</option>
                            <option value="Other">Other (Specify)</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="customFeeTypeGroup" style="display: none;">
                        <label for="customFeeType">Custom Fee Type</label>
                        <input type="text" id="customFeeType" name="customFeeType" class="form-control" 
                               placeholder="Enter custom fee type">
                    </div>
                    
                    <div class="form-group">
                        <label for="feeAmount" class="required">Amount (₹)</label>
                        <input type="number" id="feeAmount" name="amount" class="form-control" 
                               required min="1" step="1" placeholder="Enter fee amount">
                    </div>
                    
                    <div class="form-group">
                        <label for="feeFrequency" class="required">Frequency</label>
                        <select id="feeFrequency" name="frequency" class="form-control" required>
                            <option value="">Select Frequency</option>
                            <option value="Monthly">Monthly</option>
                            <option value="Quarterly">Quarterly</option>
                            <option value="Half-Yearly">Half-Yearly</option>
                            <option value="Yearly">Yearly</option>
                            <option value="One-time">One-time</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="dueDate" class="required">Due Date</label>
                        <input type="number" id="dueDate" name="dueDate" class="form-control" 
                               required min="1" max="31" placeholder="Day of month (1-31)">
                        <small class="form-help">Day of month when fee is due</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="lateFee">Late Fee (₹)</label>
                        <input type="number" id="lateFee" name="lateFee" class="form-control" 
                               min="0" step="1" placeholder="Late fee amount (optional)">
                    </div>
                    
                    <div class="form-group">
                        <label for="gracePeriod">Grace Period (Days)</label>
                        <input type="number" id="gracePeriod" name="gracePeriod" class="form-control" 
                               min="0" step="1" placeholder="Grace period before late fee applies">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="feeDescription">Description</label>
                        <textarea id="feeDescription" name="description" class="form-control" 
                                  rows="3" placeholder="Optional description for this fee type"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="feeStatus">Status</label>
                        <select id="feeStatus" name="status" class="form-control">
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeFeeModal()">
                        <i class="fas fa-times"></i>
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-brand-primary">
                        <i class="fas fa-save"></i>
                        Save Fee Structure
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Fee Structure Specific Styles -->
<style>
.overview-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.overview-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border-left: 4px solid;
}

.overview-card.total-fees {
    border-left-color: #007bff;
}

.overview-card.active-fees {
    border-left-color: #28a745;
}

.overview-card.monthly-fees {
    border-left-color: #17a2b8;
}

.overview-card.quarterly-fees {
    border-left-color: #6f42c1;
}

.card-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    font-size: 1.25rem;
}

.total-fees .card-icon {
    background: rgba(0, 123, 255, 0.1);
    color: #007bff;
}

.active-fees .card-icon {
    background: rgba(40, 167, 69, 0.1);
    color: #28a745;
}

.monthly-fees .card-icon {
    background: rgba(23, 162, 184, 0.1);
    color: #17a2b8;
}

.quarterly-fees .card-icon {
    background: rgba(111, 66, 193, 0.1);
    color: #6f42c1;
}

.fee-type-info {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.fee-description {
    color: #6c757d;
    font-size: 0.8rem;
}

.frequency-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.8rem;
    font-weight: 500;
}

.frequency-monthly {
    background: #d1ecf1;
    color: #0c5460;
}

.frequency-quarterly {
    background: #e2e3f0;
    color: #383d41;
}

.frequency-yearly {
    background: #d4edda;
    color: #155724;
}

.frequency-one-time {
    background: #fff3cd;
    color: #856404;
}

.due-date {
    font-weight: 500;
}

.no-late-fee {
    color: #6c757d;
    font-style: italic;
}

.large-modal .modal-content {
    max-width: 800px;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-help {
    display: block;
    font-size: 0.875rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.actions {
    display: flex;
    gap: 0.5rem;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 4px;
    border: none;
    background: none;
    color: #6c757d;
    cursor: pointer;
    transition: all 0.2s;
}

.edit-btn:hover {
    background: #e7f3ff;
    color: #0066cc;
}

.copy-btn:hover {
    background: #e6f7ff;
    color: #0066cc;
}

.toggle-btn:hover {
    background: #fff0e6;
    color: #cc6600;
}

.delete-btn:hover {
    background: #ffe6e6;
    color: #cc0000;
}

@media (max-width: 768px) {
    .overview-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .table-responsive {
        overflow-x: auto;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<!-- Fee Structure Management Scripts -->
<script>
function openAddFeeModal() {
    document.getElementById('modalTitle').textContent = 'Add Fee Structure';
    document.getElementById('feeStructureForm').reset();
    document.getElementById('feeId').value = '';
    document.getElementById('feeStructureModal').style.display = 'block';
}

function closeFeeModal() {
    document.getElementById('feeStructureModal').style.display = 'none';
}

function editFeeStructure(feeId) {
    // Mock data - in real implementation, fetch from server
    const feeData = {
        id: feeId,
        class: '10th',
        feeType: 'Tuition Fee',
        amount: 5000,
        frequency: 'Monthly',
        dueDate: 5,
        lateFee: 100,
        gracePeriod: 7,
        description: 'Monthly tuition fee',
        status: 'Active'
    };
    
    document.getElementById('modalTitle').textContent = 'Edit Fee Structure';
    document.getElementById('feeId').value = feeData.id;
    document.getElementById('feeClass').value = feeData.class;
    document.getElementById('feeType').value = feeData.feeType;
    document.getElementById('feeAmount').value = feeData.amount;
    document.getElementById('feeFrequency').value = feeData.frequency;
    document.getElementById('dueDate').value = feeData.dueDate;
    document.getElementById('lateFee').value = feeData.lateFee;
    document.getElementById('gracePeriod').value = feeData.gracePeriod;
    document.getElementById('feeDescription').value = feeData.description;
    document.getElementById('feeStatus').value = feeData.status;
    
    document.getElementById('feeStructureModal').style.display = 'block';
}

function copyFeeStructure(feeId) {
    if (confirm('Copy this fee structure to other classes?')) {
        // Implement copy functionality
        alert('Feature will be implemented to copy fee structure to selected classes.');
    }
}

function toggleFeeStatus(feeId) {
    if (confirm('Toggle the status of this fee structure?')) {
        // Implement toggle functionality
        alert('Fee status will be toggled.');
        location.reload();
    }
}

function deleteFeeStructure(feeId) {
    if (confirm('Are you sure you want to delete this fee structure? This action cannot be undone.')) {
        // Implement delete functionality
        alert('Fee structure will be deleted.');
        location.reload();
    }
}

function saveFeeStructure(event) {
    event.preventDefault();
    
    const formData = new FormData(event.target);
    const feeData = Object.fromEntries(formData.entries());
    
    // Validate form data
    if (!feeData.class || !feeData.feeType || !feeData.amount) {
        alert('Please fill in all required fields.');
        return;
    }
    
    // Submit fee structure data
    console.log('Saving fee structure:', feeData);
    
    // In real implementation, send to server
    alert('Fee structure saved successfully!');
    closeFeeModal();
    location.reload();
}

function exportFeeStructure() {
    // Implement export functionality
    alert('Fee structure will be exported to Excel/CSV format.');
}

function bulkUpdateFees() {
    // Implement bulk update functionality
    alert('Bulk update interface will be opened.');
}

// Handle custom fee type visibility
document.getElementById('feeType').addEventListener('change', function() {
    const customGroup = document.getElementById('customFeeTypeGroup');
    if (this.value === 'Other') {
        customGroup.style.display = 'block';
        document.getElementById('customFeeType').required = true;
    } else {
        customGroup.style.display = 'none';
        document.getElementById('customFeeType').required = false;
    }
});

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('feeStructureModal');
    if (event.target === modal) {
        closeFeeModal();
    }
}
</script>
