<!-- Add New Student Form -->
<main class="main-content">
   <!-- Page Header -->
   <div class="page-header">
      <div class="header-content">
         <nav class="breadcrumb">
            <a href="/students" class="breadcrumb-link">
               <i class="fas fa-user-graduate"></i>
               Students
            </a>
            <span class="breadcrumb-separator">/</span>
            <span class="breadcrumb-current">Add New Student</span>
         </nav>

         <h1 class="page-title">Add New Student</h1>
         <p class="page-description">Register a new student in the system</p>
      </div>
   </div>

   <!-- Student Registration Form -->
   <div class="form-container">
      <form action="/students" method="POST" class="student-form" id="studentForm">
         <!-- Personal Information Section -->
         <div class="form-section">
            <h3 class="section-title">
               <i class="fas fa-user"></i>
               Personal Information
            </h3>

            <div class="form-grid">
               <div class="form-group">
                  <label for="firstName" class="required">First Name</label>
                  <input
                     type="text"
                     id="firstName"
                     name="firstName"
                     class="form-control"
                     required
                     placeholder="Enter first name" />
               </div>

               <div class="form-group">
                  <label for="lastName" class="required">Last Name</label>
                  <input
                     type="text"
                     id="lastName"
                     name="lastName"
                     class="form-control"
                     required
                     placeholder="Enter last name" />
               </div>

               <div class="form-group">
                  <label for="dateOfBirth" class="required">Date of Birth</label>
                  <input type="date" id="dateOfBirth" name="dateOfBirth" class="form-control" required />
               </div>

               <div class="form-group">
                  <label for="gender" class="required">Gender</label>
                  <select id="gender" name="gender" class="form-control" required>
                     <option value="">Select Gender</option>
                     <option value="Male">Male</option>
                     <option value="Female">Female</option>
                     <option value="Other">Other</option>
                  </select>
               </div>
            </div>
         </div>

         <!-- Academic Information Section -->
         <div class="form-section">
            <h3 class="section-title">
               <i class="fas fa-graduation-cap"></i>
               Academic Information
            </h3>

            <div class="form-grid">
               <div class="form-group">
                  <label for="rollNumber">Roll Number</label>
                  <input
                     type="text"
                     id="rollNumber"
                     name="rollNumber"
                     class="form-control"
                     placeholder="Auto-generated if left blank" />
                  <small class="form-help">Leave blank for auto-generation</small>
               </div>

               <div class="form-group">
                  <label for="class" class="required">Class <span class="text-danger">*</span></label>
                  <select id="class" name="class" class="form-control" required>
                     <option value="">-- Select Class --</option>
                     <% if (locals.classes && classes.length > 0) { %>
                        <% classes.forEach(function(cls) { %>
                           <option value="<%= cls.id %>" data-name="<%= cls.name || cls.class_name %>">
                              <%= cls.name || cls.class_name %> (<%= cls.grade || cls.class_order %>)
                           </option>
                        <% }); %>
                     <% } else { %>
                        <!-- Fallback hardcoded options for when dynamic loading is not implemented -->
                        <option value="1">Nursery</option>
                        <option value="2">LKG</option>
                        <option value="3">UKG</option>
                        <option value="4">1st</option>
                        <option value="5">2nd</option>
                        <option value="6">3rd</option>
                        <option value="7">4th</option>
                        <option value="8">5th</option>
                        <option value="9">6th</option>
                        <option value="10">7th</option>
                        <option value="11">8th</option>
                        <option value="12">9th</option>
                        <option value="13">10th</option>
                        <option value="14">11th</option>
                        <option value="15">12th</option>
                     <% } %>
                  </select>
                  <small class="form-text text-muted">Student will be enrolled in the selected class</small>
               </div>

               <div class="form-group">
                  <label for="section" class="required">Section <span class="text-danger">*</span></label>
                  <select id="section" name="section" class="form-control" required>
                     <option value="">-- Select Section --</option>
                     <% if (locals.sections && sections.length > 0) { %>
                        <% sections.forEach(function(section) { %>
                           <option value="<%= section.id %>" data-class-id="<%= section.class_id %>">
                              <%= section.name %> 
                              <% if (section.capacity) { %>
                                 (Capacity: <%= section.capacity %>)
                              <% } %>
                           </option>
                        <% }); %>
                     <% } else { %>
                        <!-- Fallback hardcoded options for when dynamic loading is not implemented -->
                        <option value="1">A</option>
                        <option value="2">B</option>
                        <option value="3">C</option>
                        <option value="4">D</option>
                     <% } %>
                  </select>
                  <small class="form-text text-muted">Choose section within the selected class</small>
               </div>
                     <option value="">Select Section</option>
                     <option value="A">A</option>
                     <option value="B">B</option>
                     <option value="C">C</option>
                     <option value="D">D</option>
                     <option value="E">E</option>
                  </select>
               </div>

               <div class="form-group">
                  <label for="admissionDate" class="required">Admission Date</label>
                  <input
                     type="date"
                     id="admissionDate"
                     name="admissionDate"
                     class="form-control"
                     required
                     value="<%= new Date().toISOString().split('T')[0] %>" />
               </div>
            </div>
         </div>

         <!-- Contact Information Section -->
         <div class="form-section">
            <h3 class="section-title">
               <i class="fas fa-address-book"></i>
               Contact Information
            </h3>

            <div class="form-grid">
               <div class="form-group full-width">
                  <label for="address">Address</label>
                  <textarea
                     id="address"
                     name="address"
                     class="form-control"
                     rows="3"
                     placeholder="Enter complete address"></textarea>
               </div>

               <div class="form-group">
                  <label for="phone">Phone Number</label>
                  <input
                     type="tel"
                     id="phone"
                     name="phone"
                     class="form-control"
                     placeholder="Student's phone number (optional)" />
               </div>

               <div class="form-group">
                  <label for="email">Email Address</label>
                  <input
                     type="email"
                     id="email"
                     name="email"
                     class="form-control"
                     placeholder="Student's email (optional)" />
               </div>
            </div>
         </div>

         <!-- Guardian Information Section -->
         <div class="form-section">
            <h3 class="section-title">
               <i class="fas fa-users"></i>
               Guardian Information
            </h3>

            <div class="form-grid">
               <div class="form-group">
                  <label for="guardianName" class="required">Guardian Name</label>
                  <input
                     type="text"
                     id="guardianName"
                     name="guardianName"
                     class="form-control"
                     required
                     placeholder="Father/Mother/Guardian name" />
               </div>

               <div class="form-group">
                  <label for="guardianRelation" class="required">Relation</label>
                  <select id="guardianRelation" name="guardianRelation" class="form-control" required>
                     <option value="">Select Relation</option>
                     <option value="Father">Father</option>
                     <option value="Mother">Mother</option>
                     <option value="Guardian">Guardian</option>
                     <option value="Uncle">Uncle</option>
                     <option value="Aunt">Aunt</option>
                     <option value="Grandparent">Grandparent</option>
                     <option value="Other">Other</option>
                  </select>
               </div>

               <div class="form-group">
                  <label for="guardianPhone" class="required">Guardian Phone</label>
                  <input
                     type="tel"
                     id="guardianPhone"
                     name="guardianPhone"
                     class="form-control"
                     required
                     placeholder="Primary contact number" />
               </div>

               <div class="form-group">
                  <label for="guardianEmail">Guardian Email</label>
                  <input
                     type="email"
                     id="guardianEmail"
                     name="guardianEmail"
                     class="form-control"
                     placeholder="Guardian's email address" />
               </div>

               <div class="form-group">
                  <label for="guardianOccupation">Occupation</label>
                  <input
                     type="text"
                     id="guardianOccupation"
                     name="guardianOccupation"
                     class="form-control"
                     placeholder="Guardian's occupation" />
               </div>

               <div class="form-group">
                  <label for="emergencyContact">Emergency Contact</label>
                  <input
                     type="tel"
                     id="emergencyContact"
                     name="emergencyContact"
                     class="form-control"
                     placeholder="Alternative emergency number" />
               </div>
            </div>
         </div>

         <!-- Additional Information Section -->
         <div class="form-section">
            <h3 class="section-title">
               <i class="fas fa-info-circle"></i>
               Additional Information
            </h3>

            <div class="form-grid">
               <div class="form-group">
                  <label for="bloodGroup">Blood Group</label>
                  <select id="bloodGroup" name="bloodGroup" class="form-control">
                     <option value="">Select Blood Group</option>
                     <option value="A+">A+</option>
                     <option value="A-">A-</option>
                     <option value="B+">B+</option>
                     <option value="B-">B-</option>
                     <option value="AB+">AB+</option>
                     <option value="AB-">AB-</option>
                     <option value="O+">O+</option>
                     <option value="O-">O-</option>
                  </select>
               </div>

               <div class="form-group">
                  <label for="religion">Religion</label>
                  <input
                     type="text"
                     id="religion"
                     name="religion"
                     class="form-control"
                     placeholder="Student's religion (optional)" />
               </div>

               <div class="form-group">
                  <label for="caste">Caste/Category</label>
                  <select id="caste" name="caste" class="form-control">
                     <option value="">Select Category</option>
                     <option value="General">General</option>
                     <option value="OBC">OBC</option>
                     <option value="SC">SC</option>
                     <option value="ST">ST</option>
                     <option value="Other">Other</option>
                  </select>
               </div>

               <div class="form-group">
                  <label for="previousSchool">Previous School</label>
                  <input
                     type="text"
                     id="previousSchool"
                     name="previousSchool"
                     class="form-control"
                     placeholder="Name of previous school (if any)" />
               </div>

               <div class="form-group full-width">
                  <label for="medicalConditions">Medical Conditions</label>
                  <textarea
                     id="medicalConditions"
                     name="medicalConditions"
                     class="form-control"
                     rows="3"
                     placeholder="Any medical conditions, allergies, or special requirements"></textarea>
               </div>

               <div class="form-group full-width">
                  <label for="remarks">Remarks</label>
                  <textarea
                     id="remarks"
                     name="remarks"
                     class="form-control"
                     rows="3"
                     placeholder="Any additional notes or comments"></textarea>
               </div>
            </div>
         </div>

         <!-- Form Actions -->
         <div class="form-actions">
            <button type="button" class="btn btn-outline" onclick="history.back()">
               <i class="fas fa-times"></i>
               Cancel
            </button>

            <button type="reset" class="btn btn-secondary">
               <i class="fas fa-undo"></i>
               Reset Form
            </button>

            <button type="submit" class="btn btn-brand-primary">
               <i class="fas fa-save"></i>
               Add Student
            </button>
         </div>
      </form>
   </div>
</main>

<!-- Form Validation and Enhancement Scripts -->
<script>
   document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('studentForm');

      // Form validation
      form.addEventListener('submit', function (e) {
         if (!validateForm()) {
            e.preventDefault();
            return false;
         }
      });

      // Auto-generate roll number if needed
      const rollNumberInput = document.getElementById('rollNumber');
      const classSelect = document.getElementById('class');
      const sectionSelect = document.getElementById('section');

      function generateRollNumber() {
         if (!rollNumberInput.value && classSelect.value && sectionSelect.value) {
            const timestamp = Date.now().toString().slice(-4);
            const classCode = classSelect.value.replace(/[^0-9]/g, '') || classSelect.value.charAt(0).toUpperCase();
            const rollNumber = `${classCode}${sectionSelect.value}${timestamp}`;
            rollNumberInput.placeholder = `Suggested: ${rollNumber}`;
         }
      }

      classSelect.addEventListener('change', generateRollNumber);
      sectionSelect.addEventListener('change', generateRollNumber);

      // Phone number formatting
      const phoneInputs = document.querySelectorAll('input[type="tel"]');
      phoneInputs.forEach((input) => {
         input.addEventListener('input', function (e) {
            // Remove non-numeric characters
            let value = e.target.value.replace(/\D/g, '');
            // Limit to 10 digits for Indian phone numbers
            if (value.length > 10) {
               value = value.slice(0, 10);
            }
            e.target.value = value;
         });
      });

      function validateForm() {
         const requiredFields = form.querySelectorAll('[required]');
         let isValid = true;

         requiredFields.forEach((field) => {
            if (!field.value.trim()) {
               field.classList.add('error');
               isValid = false;
            } else {
               field.classList.remove('error');
            }
         });

         // Validate phone numbers
         const phoneFields = ['guardianPhone'];
         phoneFields.forEach((fieldName) => {
            const field = document.getElementById(fieldName);
            if (field && field.value && field.value.length !== 10) {
               field.classList.add('error');
               isValid = false;
            }
         });

         if (!isValid) {
            alert('Please fill in all required fields correctly.');
         }

         return isValid;
      }
   });
</script>

<!-- Additional Styles for Student Form -->
<style>
   .form-container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
   }

   .student-form {
      padding: 2rem;
   }

   .form-section {
      margin-bottom: 3rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid #e9ecef;
   }

   .form-section:last-of-type {
      border-bottom: none;
      margin-bottom: 2rem;
   }

   .section-title {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: #495057;
      margin-bottom: 1.5rem;
      font-size: 1.25rem;
      font-weight: 600;
   }

   .section-title i {
      color: #007bff;
   }

   .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
   }

   .form-group.full-width {
      grid-column: 1 / -1;
   }

   .form-group label {
      display: block;
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #495057;
   }

   .form-group label.required::after {
      content: ' *';
      color: #dc3545;
   }

   .form-control {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ced4da;
      border-radius: 6px;
      font-size: 1rem;
      transition: all 0.2s;
   }

   .form-control:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
   }

   .form-control.error {
      border-color: #dc3545;
      box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
   }

   .form-help {
      display: block;
      font-size: 0.875rem;
      color: #6c757d;
      margin-top: 0.25rem;
   }

   textarea.form-control {
      resize: vertical;
      min-height: 100px;
   }

   .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      padding-top: 2rem;
      border-top: 1px solid #e9ecef;
   }

   .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      font-size: 0.875rem;
   }

   .breadcrumb-link {
      color: #007bff;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.25rem;
   }

   .breadcrumb-link:hover {
      text-decoration: underline;
   }

   .breadcrumb-separator {
      color: #6c757d;
   }

   .breadcrumb-current {
      color: #495057;
      font-weight: 500;
   }

   @media (max-width: 768px) {
      .form-grid {
         grid-template-columns: 1fr;
      }

      .form-actions {
         flex-direction: column;
      }

      .student-form {
         padding: 1rem;
      }
   }
</style>
