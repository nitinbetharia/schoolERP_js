<!-- Communication Setup Step -->
<div class="communication-setup-step">
  <div class="row">
    <!-- Email Configuration -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">
          <h5 class="card-title mb-0"><i class="fas fa-envelope"></i> Email Configuration</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="enableEmail"
                name="enable_email_notifications"
              />
              <label class="form-check-label" for="enableEmail"> Enable Email Notifications </label>
            </div>
            <div class="form-text">
              Enable this to send automated emails to parents and students
            </div>
          </div>

          <div id="emailProviderSection" style="display: none">
            <div class="mb-3">
              <label for="emailProvider" class="form-label">Email Provider *</label>
              <select class="form-select" id="emailProvider" name="email_provider">
                <option value="">Select Provider</option>
                <option value="SMTP">SMTP (Generic)</option>
                <option value="GMAIL">Gmail</option>
                <option value="SENDGRID">SendGrid</option>
                <option value="MAILGUN">Mailgun</option>
              </select>
            </div>

            <div class="mb-3">
              <label for="fromEmail" class="form-label">From Email *</label>
              <input
                type="email"
                class="form-control"
                id="fromEmail"
                name="from_email"
                placeholder="noreply@yourschool.com"
              />
              <div class="form-text">
                This email will appear as the sender for all automated emails
              </div>
            </div>

            <div class="mb-3">
              <label for="fromName" class="form-label">From Name *</label>
              <input
                type="text"
                class="form-control"
                id="fromName"
                name="from_name"
                placeholder="Your School Name"
              />
            </div>

            <!-- Provider Specific Configurations -->
            <div id="smtpConfig" class="provider-config" style="display: none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>SMTP Configuration:</strong> Use these settings for generic SMTP providers
                like your hosting provider's SMTP.
              </div>
              <div class="row">
                <div class="col-md-8">
                  <div class="mb-3">
                    <label for="smtpHost" class="form-label">SMTP Host *</label>
                    <input
                      type="text"
                      class="form-control"
                      id="smtpHost"
                      name="smtp_host"
                      placeholder="smtp.gmail.com"
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="mb-3">
                    <label for="smtpPort" class="form-label">Port *</label>
                    <input
                      type="number"
                      class="form-control"
                      id="smtpPort"
                      name="smtp_port"
                      value="587"
                    />
                  </div>
                </div>
              </div>
              <div class="mb-3">
                <label for="smtpUsername" class="form-label">Username *</label>
                <input type="text" class="form-control" id="smtpUsername" name="smtp_username" />
              </div>
              <div class="mb-3">
                <label for="smtpPassword" class="form-label">Password *</label>
                <input
                  type="password"
                  class="form-control"
                  id="smtpPassword"
                  name="smtp_password"
                />
              </div>
            </div>

            <div id="gmailConfig" class="provider-config" style="display: none">
              <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Gmail Configuration:</strong> You'll need to enable 2FA and create an App
                Password for Gmail.
              </div>
              <div class="mb-3">
                <label for="gmailUsername" class="form-label">Gmail Address *</label>
                <input
                  type="email"
                  class="form-control"
                  id="gmailUsername"
                  name="gmail_username"
                  placeholder="your-email@gmail.com"
                />
              </div>
              <div class="mb-3">
                <label for="gmailAppPassword" class="form-label">App Password *</label>
                <input
                  type="password"
                  class="form-control"
                  id="gmailAppPassword"
                  name="gmail_app_password"
                />
                <div class="form-text">
                  <a href="https://support.google.com/accounts/answer/185833" target="_blank"
                    >How to create Gmail App Password?</a
                  >
                </div>
              </div>
            </div>

            <div id="sendgridConfig" class="provider-config" style="display: none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>SendGrid:</strong> Professional email service with high deliverability
                rates.
              </div>
              <div class="mb-3">
                <label for="sendgridApiKey" class="form-label">SendGrid API Key *</label>
                <input
                  type="password"
                  class="form-control"
                  id="sendgridApiKey"
                  name="sendgrid_api_key"
                />
                <div class="form-text">Get your API key from SendGrid dashboard</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SMS Configuration -->
    <div class="col-lg-6">
      <div class="card h-100">
        <div class="card-header">
          <h5 class="card-title mb-0"><i class="fas fa-sms"></i> SMS Configuration</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="enableSMS"
                name="enable_sms_notifications"
              />
              <label class="form-check-label" for="enableSMS"> Enable SMS Notifications </label>
            </div>
            <div class="form-text">Enable this to send automated SMS to parents and students</div>
          </div>

          <div id="smsProviderSection" style="display: none">
            <div class="mb-3">
              <label for="smsProvider" class="form-label">SMS Provider *</label>
              <select class="form-select" id="smsProvider" name="sms_provider">
                <option value="">Select Provider</option>
                <option value="TEXTLOCAL">TextLocal (India)</option>
                <option value="MSG91">MSG91 (India)</option>
                <option value="FAST2SMS">Fast2SMS (India)</option>
                <option value="TWILIO">Twilio (Global)</option>
              </select>
            </div>

            <!-- Provider Specific Configurations -->
            <div id="textlocalConfig" class="provider-config" style="display: none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>TextLocal:</strong> Popular SMS service for Indian businesses.
              </div>
              <div class="mb-3">
                <label for="textlocalApiKey" class="form-label">TextLocal API Key *</label>
                <input
                  type="password"
                  class="form-control"
                  id="textlocalApiKey"
                  name="textlocal_api_key"
                />
              </div>
              <div class="mb-3">
                <label for="textlocalSender" class="form-label">Sender ID *</label>
                <input
                  type="text"
                  class="form-control"
                  id="textlocalSender"
                  name="textlocal_sender"
                  maxlength="6"
                  placeholder="SCHOOL"
                />
                <div class="form-text">6 characters maximum</div>
              </div>
            </div>

            <div id="msg91Config" class="provider-config" style="display: none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>MSG91:</strong> Reliable SMS service with good delivery rates in India.
              </div>
              <div class="mb-3">
                <label for="msg91AuthKey" class="form-label">MSG91 Auth Key *</label>
                <input
                  type="password"
                  class="form-control"
                  id="msg91AuthKey"
                  name="msg91_auth_key"
                />
              </div>
              <div class="mb-3">
                <label for="msg91SenderId" class="form-label">Sender ID *</label>
                <input
                  type="text"
                  class="form-control"
                  id="msg91SenderId"
                  name="msg91_sender_id"
                  maxlength="6"
                  placeholder="SCHOOL"
                />
                <div class="form-text">6 characters maximum</div>
              </div>
            </div>

            <div id="fast2smsConfig" class="provider-config" style="display: none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Fast2SMS:</strong> Affordable SMS solution for Indian schools.
              </div>
              <div class="mb-3">
                <label for="fast2smsApiKey" class="form-label">Fast2SMS API Key *</label>
                <input
                  type="password"
                  class="form-control"
                  id="fast2smsApiKey"
                  name="fast2sms_api_key"
                />
              </div>
              <div class="mb-3">
                <label for="fast2smsSenderId" class="form-label">Sender ID *</label>
                <input
                  type="text"
                  class="form-control"
                  id="fast2smsSenderId"
                  name="fast2sms_sender_id"
                  maxlength="6"
                  placeholder="SCHOOL"
                />
                <div class="form-text">6 characters maximum</div>
              </div>
            </div>

            <div id="twilioConfig" class="provider-config" style="display: none">
              <div class="alert alert-info">
                <i class="fas fa-info-circle"></i>
                <strong>Twilio:</strong> Global SMS service with premium features.
              </div>
              <div class="mb-3">
                <label for="twilioAccountSid" class="form-label">Account SID *</label>
                <input
                  type="password"
                  class="form-control"
                  id="twilioAccountSid"
                  name="twilio_account_sid"
                />
              </div>
              <div class="mb-3">
                <label for="twilioAuthToken" class="form-label">Auth Token *</label>
                <input
                  type="password"
                  class="form-control"
                  id="twilioAuthToken"
                  name="twilio_auth_token"
                />
              </div>
              <div class="mb-3">
                <label for="twilioFromNumber" class="form-label">From Number *</label>
                <input
                  type="text"
                  class="form-control"
                  id="twilioFromNumber"
                  name="twilio_from_number"
                  placeholder="+1234567890"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Skip Option -->
  <div class="row mt-4">
    <div class="col-12">
      <div class="alert alert-light border">
        <div class="form-check">
          <input
            class="form-check-input"
            type="checkbox"
            id="skipCommunication"
            name="skip_communication_setup"
          />
          <label class="form-check-label" for="skipCommunication">
            <strong>Skip communication setup for now</strong>
          </label>
        </div>
        <div class="form-text">
          You can configure email and SMS providers later from the admin panel. The system will work
          without these services, but automated notifications won't be sent.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Email provider toggle
    document.getElementById('enableEmail').addEventListener('change', function () {
      const section = document.getElementById('emailProviderSection');
      section.style.display = this.checked ? 'block' : 'none';

      // If skipping, uncheck this
      if (this.checked) {
        document.getElementById('skipCommunication').checked = false;
      }
    });

    // SMS provider toggle
    document.getElementById('enableSMS').addEventListener('change', function () {
      const section = document.getElementById('smsProviderSection');
      section.style.display = this.checked ? 'block' : 'none';

      // If skipping, uncheck this
      if (this.checked) {
        document.getElementById('skipCommunication').checked = false;
      }
    });

    // Email provider change
    document.getElementById('emailProvider').addEventListener('change', function () {
      // Hide all provider configs
      document.querySelectorAll('#emailProviderSection .provider-config').forEach(config => {
        config.style.display = 'none';
      });

      // Show selected provider config
      if (this.value) {
        const configElement = document.getElementById(this.value.toLowerCase() + 'Config');
        if (configElement) {
          configElement.style.display = 'block';
        }
      }
    });

    // SMS provider change
    document.getElementById('smsProvider').addEventListener('change', function () {
      // Hide all provider configs
      document.querySelectorAll('#smsProviderSection .provider-config').forEach(config => {
        config.style.display = 'none';
      });

      // Show selected provider config
      if (this.value) {
        const configElement = document.getElementById(this.value.toLowerCase() + 'Config');
        if (configElement) {
          configElement.style.display = 'block';
        }
      }
    });

    // Skip communication setup
    document.getElementById('skipCommunication').addEventListener('change', function () {
      if (this.checked) {
        // Uncheck email and SMS
        document.getElementById('enableEmail').checked = false;
        document.getElementById('enableSMS').checked = false;

        // Hide sections
        document.getElementById('emailProviderSection').style.display = 'none';
        document.getElementById('smsProviderSection').style.display = 'none';
      }
    });

    // Auto-fill from name based on from email
    document.getElementById('fromEmail').addEventListener('blur', function () {
      const fromNameField = document.getElementById('fromName');
      if (!fromNameField.value && this.value) {
        const domain = this.value.split('@')[1];
        if (domain) {
          const schoolName = domain.split('.')[0];
          fromNameField.value =
            schoolName.charAt(0).toUpperCase() + schoolName.slice(1) + ' School';
        }
      }
    });
  });
</script>

<style>
  .provider-config {
    border-left: 3px solid #007bff;
    padding-left: 1rem;
    margin-left: 0.5rem;
    background-color: #f8f9fa;
    border-radius: 0.375rem;
    padding: 1rem;
    margin-top: 1rem;
  }

  .alert a {
    color: inherit;
    text-decoration: underline;
  }

  .card {
    transition: box-shadow 0.15s ease-in-out;
  }

  .card:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
  }
</style>
